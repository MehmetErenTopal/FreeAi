<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeAI - Özgür Yapay Zeka Deneyimi</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <!-- Marked & Highlight.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #0b0f19; color: #e5e7eb; margin: 0; padding: 0; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Markdown Stilleri */
        .markdown-body { line-height: 1.6; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin: 1rem 0; background: #161b22; border-radius: 8px; overflow: hidden; border: 1px solid #30363d; }
        .markdown-body th { background: #21262d; color: #58a6ff; font-weight: 600; text-align: left; padding: 12px 15px; border: 1px solid #30363d; }
        .markdown-body td { padding: 10px 15px; border: 1px solid #30363d; }

        /* Yazma Göstergesi */
        .typing-indicator span { display: inline-block; width: 8px; height: 8px; background-color: #3b82f6; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; margin: 0 2px; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Sabit Hoşgeldin Kartı Stili */
        .welcome-card {
            background: linear-gradient(145deg, rgba(22, 27, 34, 0.5), rgba(11, 15, 25, 0.8));
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        #custom-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Modal: Sohbeti Temizle -->
    <div id="custom-modal">
        <div class="bg-[#161b22] border border-gray-800 p-6 rounded-2xl max-w-sm w-full mx-4 shadow-2xl">
            <h3 class="text-xl font-bold text-white mb-2 text-center">Sohbet Sıfırlansın mı?</h3>
            <p class="text-gray-400 text-sm mb-6 text-center">Geçmişiniz kalıcı olarak silinecektir.</p>
            <div class="flex gap-3">
                <button onclick="closeModal()" class="flex-1 px-4 py-2 rounded-xl bg-gray-800 text-gray-300 hover:bg-gray-700 transition">Vazgeç</button>
                <button onclick="confirmClearChat()" class="flex-1 px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-500 transition">Sil</button>
            </div>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden relative">
        <main class="flex-1 flex flex-col bg-[#0b0f19] relative min-w-0">
            
            <!-- HEADER -->
            <header class="h-14 border-b border-gray-800 flex items-center justify-between px-4 bg-[#0b0f19]/80 backdrop-blur-md z-30 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                            <i class="fa-solid fa-bolt text-white text-sm"></i>
                        </div>
                        <h1 class="font-bold text-lg tracking-tight hidden sm:block">FreeAI</h1>
                    </div>
                    <div class="h-4 w-[1px] bg-gray-700 mx-1"></div>
                    <select id="modelSelect" class="bg-transparent border-none text-sm font-medium text-blue-400 focus:ring-0 cursor-pointer hover:text-blue-300 transition outline-none max-w-[200px] sm:max-w-none">
                        <!-- JS ile doldurulacak -->
                    </select>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="showClearModal()" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-red-600/10 text-red-500 hover:bg-red-600/20 transition-all border border-red-500/20 text-xs font-semibold">
                        <i class="fa-solid fa-trash-can"></i>
                        <span class="hidden sm:inline">Sohbeti Temizle</span>
                    </button>
                </div>
            </header>

            <!-- CHAT AREA -->
            <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-6 lg:p-12 space-y-8 scrollbar-hide">
                
                <!-- SABİT HOŞ GELDİN EKRANI -->
                <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center max-w-3xl mx-auto space-y-8">
                    <div class="relative">
                        <div class="w-24 h-24 bg-blue-600/10 rounded-[2rem] flex items-center justify-center border border-blue-500/20 shadow-2xl shadow-blue-500/5">
                            <i class="fa-solid fa-microchip text-5xl text-blue-500"></i>
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-500 border-2 border-[#0b0f19] rounded-full"></div>
                    </div>

                    <div class="space-y-4">
                        <h2 class="text-4xl font-extrabold text-white tracking-tight">FreeAI'ye Hoş Geldiniz</h2>
                        <p class="text-gray-400 text-lg max-w-xl mx-auto leading-relaxed">
                            Dünyanın en gelişmiş yapay zeka modellerini tek bir arayüzde birleştiren özgür platform.
                        </p>
                    </div>

                    <!-- Platform Özellikleri -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full">
                        <div class="welcome-card p-6 rounded-2xl text-left space-y-2 hover:border-blue-500/40 transition-colors">
                            <i class="fa-solid fa-gauge-high text-blue-500 mb-2"></i>
                            <h3 class="text-white font-semibold">Ultra Hızlı</h3>
                            <p class="text-xs text-gray-500">Düşük gecikme süresi ile saniyeler içinde yanıt alın.</p>
                        </div>
                        <div class="welcome-card p-6 rounded-2xl text-left space-y-2 hover:border-blue-500/40 transition-colors">
                            <i class="fa-solid fa-shield-halved text-blue-500 mb-2"></i>
                            <h3 class="text-white font-semibold">Güvenli</h3>
                            <p class="text-xs text-gray-500">Verileriniz uçtan uca gizlilik prensibiyle işlenir.</p>
                        </div>
                        <div class="welcome-card p-6 rounded-2xl text-left space-y-2 hover:border-blue-500/40 transition-colors">
                            <i class="fa-solid fa-layer-group text-blue-500 mb-2"></i>
                            <h3 class="text-white font-semibold">Çeşitlilik</h3>
                            <p class="text-xs text-gray-500">Onlarca farklı marka ve uzmanlaşmış model seçeneği.</p>
                        </div>
                    </div>
                </div>

                <div id="messages-wrapper" class="space-y-8"></div>
            </div>

            <!-- INPUT AREA -->
            <div class="border-t border-gray-800/50 bg-[#0b0f19] p-4 md:p-8 shrink-0 z-20">
                <div class="max-w-4xl mx-auto relative">
                    <form id="chatForm" onsubmit="sendMessage(event)" class="relative flex items-end gap-2 bg-[#161b22] border border-gray-700 rounded-2xl p-2 transition-all focus-within:border-blue-500/50 focus-within:ring-1 focus-within:ring-blue-500/20">
                        <textarea id="promptInput" rows="1" 
                            class="flex-1 max-h-48 p-3 bg-transparent border-none text-gray-200 placeholder-gray-500 focus:ring-0 outline-none resize-none text-sm md:text-base scrollbar-hide" 
                            placeholder="Bir mesaj yazın..." 
                            required
                            oninput="autoResize(this)"
                            onkeydown="handleKeydown(event)"></textarea>
                        
                        <button type="submit" id="sendBtn" 
                            class="mb-1 mr-1 bg-blue-600 hover:bg-blue-500 text-white w-10 h-10 flex items-center justify-center rounded-xl transition-all shadow-lg shadow-blue-600/20">
                            <i class="fa-solid fa-paper-plane text-sm"></i>
                        </button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_KEY = atob("c2stb3ItdjEtYWE5Y2NkZjJmNGFhZTFiYTNmODdkNDc3MDg4NjlmODhiOGNmZTJmMmMwYTE4ZDQ4YTVkMjMyZmJkNmViYmQ5Ng==");
        
        const SYSTEM_PROMPT = {
            role: "system",
            content: `Sen FreeAI teknik asistanısın. Türkçe yanıt ver. Matematiksel formüllerde LaTeX kullan. Tablo oluşturma, Kalın font, Ara çizgi ve başlık kullanabilirsin.`
        };

        const BRAND_DATA = {
            "DeepSeek": [
                { id: "nex-agi/deepseek-v3.1-nex-n1:free", name: "DeepSeek V3.1 Nex" },
                { id: "deepseek/deepseek-r1-0528:free", name: "DeepSeek R1" },
                { id: "tngtech/deepseek-r1t2-chimera:free", name: "DeepSeek R1T2 Chimera" },
                { id: "tngtech/deepseek-r1t-chimera:free", name: "DeepSeek R1T Chimera" }
            ],
            "NVIDIA": [
                { id: "nvidia/nemotron-3-nano-30b-a3b:free", name: "Nemotron 3 Nano 30B" },
                { id: "nvidia/nemotron-nano-12b-v2-vl:free", name: "Nemotron Nano 12B VL" },
                { id: "nvidia/nemotron-nano-9b-v2:free", name: "Nemotron Nano 9B" }
            ],
            "Google": [
                { id: "google/gemma-3n-e4b-it:free", name: "Gemma 3n E4B" },
                { id: "google/gemma-3n-e2b-it:free", name: "Gemma 3n E2B" }
            ],
            "OpenAI & Mistral": [
                { id: "openai/gpt-oss-20b:free", name: "GPT OSS 20B" },
                { id: "mistralai/devstral-2512:free", name: "Mistral Devstral" },
                { id: "cognitivecomputations/dolphin-mistral-24b-venice-edition:free", name: "Dolphin Mistral 24B" }
            ],
            "Diğer Gelişmiş Modeller": [
                { id: "allenai/olmo-3.1-32b-think:free", name: "OLMO 3.1 32B Think" },
                { id: "xiaomi/mimo-v2-flash:free", name: "Xiaomi Mimo V2 Flash" },
                { id: "arcee-ai/trinity-mini:free", name: "Arcee Trinity Mini" },
                { id: "tngtech/tng-r1t-chimera:free", name: "TNG R1T Chimera" },
                { id: "kwaipilot/kat-coder-pro:free", name: "Kat Coder Pro" },
                { id: "alibaba/tongyi-deepresearch-30b-a3b:free", name: "Tongyi DeepResearch" },
                { id: "z-ai/glm-4.5-air:free", name: "Z-AI GLM 4.5 Air" }
            ]
        };

        let currentMessages = [SYSTEM_PROMPT];

        function init() {
            const select = document.getElementById('modelSelect');
            for (const [brand, models] of Object.entries(BRAND_DATA)) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = brand;
                models.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m.id;
                    opt.textContent = m.name;
                    optgroup.appendChild(opt);
                });
                select.appendChild(optgroup);
            }
            loadChatHistory();
        }

        function handleKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                document.getElementById('chatForm').requestSubmit();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 192) + 'px';
        }

        async function sendMessage(e) {
            if(e) e.preventDefault();
            const input = document.getElementById('promptInput');
            const msg = input.value.trim();
            const model = document.getElementById('modelSelect').value;
            if (!msg) return;

            input.value = '';
            input.style.height = 'auto';
            document.getElementById('welcome-screen').classList.add('hidden');

            appendMsg('user', msg);
            currentMessages.push({ role: 'user', content: msg });

            const loadingId = appendLoading();

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Content-Type": "application/json", 
                        "Authorization": `Bearer ${API_KEY}`,
                        "X-Title": "FreeAI"
                    },
                    body: JSON.stringify({ model: model, messages: currentMessages, temperature: 0.6 })
                });
                
                const data = await res.json();
                document.getElementById(loadingId)?.remove();

                if (data.choices?.[0]) {
                    const aiMsg = data.choices[0].message.content;
                    appendMsg('assistant', aiMsg);
                    currentMessages.push({ role: 'assistant', content: aiMsg });
                    saveChatHistory();
                } else {
                    appendMsg('assistant', "❌ Model yanıt vermedi. Lütfen başka bir model deneyin.");
                }
            } catch (err) {
                document.getElementById(loadingId)?.remove();
                appendMsg('assistant', "❌ Bağlantı hatası oluştu.");
            }
        }

        function appendMsg(role, text) {
            const wrapper = document.getElementById('messages-wrapper');
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-6`;
            
            // --- MATH FIX START ---
            // Marked.js, önceki "___" formatını italic/bold sandığı için bozuyordu.
            // Artık tamamen alphanumeric bir placeholder kullanıyoruz.
            let mathBlocks = [];
            let protectedText = text || '';

            const protect = (regex) => {
                protectedText = protectedText.replace(regex, (match) => {
                    mathBlocks.push(match);
                    return `MATHPLACEHOLDER${mathBlocks.length - 1}ENDMATHPLACEHOLDER`;
                });
            };

            // Regex sırası önemli: Önce display math, sonra inline
            protect(/\$\$([\s\S]*?)\$\$/g);
            protect(/\\\[([\s\S]*?)\\\]/g);
            protect(/\\\(([\s\S]*?)\\\)/g);
            protect(/\$([^$\n]+?)\$/g);

            // Markdown parse
            let htmlContent = marked.parse(protectedText);

            // Blokları geri yükle
            mathBlocks.forEach((block, index) => {
                const placeholder = `MATHPLACEHOLDER${index}ENDMATHPLACEHOLDER`;
                htmlContent = htmlContent.split(placeholder).join(block);
            });
            // --- MATH FIX END ---

            div.innerHTML = `
                <div class="relative ${role === 'user' ? 'bg-blue-600 text-white' : 'bg-[#161b22] border border-gray-800 text-gray-200'} p-5 rounded-2xl max-w-[95%] sm:max-w-[80%] shadow-xl">
                    <div class="markdown-body text-sm md:text-base leading-relaxed">${htmlContent}</div>
                </div>
            `;
            wrapper.appendChild(div);
            scrollToBottom();
            hljs.highlightAll();
            renderMathInElement(div, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false
            });
        }

        function appendLoading() {
            const id = 'load-' + Date.now();
            const wrapper = document.getElementById('messages-wrapper');
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex justify-start mb-6";
            div.innerHTML = `<div class="bg-[#161b22] border border-gray-800 p-4 rounded-2xl"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
            wrapper.appendChild(div);
            scrollToBottom();
            return id;
        }

        function scrollToBottom() {
            const container = document.getElementById('chat-container');
            container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
        }

        function saveChatHistory() { localStorage.setItem('free_ai_history', JSON.stringify(currentMessages)); }
        function loadChatHistory() {
            const saved = localStorage.getItem('free_ai_history');
            if (saved) {
                const history = JSON.parse(saved);
                currentMessages = [SYSTEM_PROMPT, ...history.filter(m => m.role !== 'system')];
                if (currentMessages.length > 1) {
                    document.getElementById('welcome-screen').classList.add('hidden');
                    currentMessages.forEach(m => { if(m.role !== 'system') appendMsg(m.role, m.content); });
                }
            }
        }

        function showClearModal() { document.getElementById('custom-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('custom-modal').style.display = 'none'; }
        function confirmClearChat() {
            currentMessages = [SYSTEM_PROMPT];
            localStorage.removeItem('free_ai_history');
            document.getElementById('messages-wrapper').innerHTML = '';
            document.getElementById('welcome-screen').classList.remove('hidden');
            closeModal();
        }

        window.onload = init;
    </script>
</body>
</html>